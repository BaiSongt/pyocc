# OCCT Python 学习库 - 详细任务安排表 (进阶计划)

本文档为 OCCT Python 学习库的进阶任务分解，承接《入门计划》，旨在引导开发者深入探索OCCT的高级功能、底层原理及应用框架，最终达到专家级水平。

---

## 第五阶段：高级曲面与特征建模

**目标**: 超越基本实体建模，掌握自由形态曲面（Free-form Surfaces）的创建、高级特征的构建以及对现有几何的修复与处理能力。

### 任务 5.1: `GeomAPI` - 创建高级曲线与曲面

- **目标**: 学习通过点集、约束等方式创建复杂的B样条曲线和曲面。
- **核心类**:
  - `GeomAPI_PointsToBSpline`: 通过一系列点创建B样条曲线。
  - `GeomAPI_PointsToBSplineSurface`: 通过一个点阵创建B样条曲面。
  - `GeomAPI_Interpolate`: 创建经过所有给定点的插值样条曲线。
- **示例焦点**: 读取一个包含空间点坐标的文本文件，然后使用 `GeomAPI_PointsToBSplineSurface` 生成一个拟合这些点的光滑曲面。

### 任务 5.2: `ShapeFix` - 几何修复

- **目标**: 学习处理从外部导入的有瑕疵的模型，修复常见的几何与拓扑错误。
- **核心类**:
  - `ShapeFix_Shape`: 对一个形状进行全面的修复，如修复面、闭合线框等。
  - `ShapeFix_Wire`: 专门用于修复线框（Wire）的工具，如处理边之间的缝隙。
  - `ShapeFix_Solid`: 修复实体，例如通过缝合面来创建实体。
- **示例焦点**: 故意创建一个有微小缝隙的壳（Shell），然后使用 `ShapeFix_Shape` 或 `ShapeFix_Solid` 将其自动修复为一个有效的、闭合的实体。

### 阶段汇总示例 (任务 5.3)

- **目标**: 综合运用高级曲面和修复技术，创建一个有机的、复杂的模型。
- **示例焦点 (`examples/phase_5_advanced_surfaces.py`)**:
  1. 创建几条复杂的空间曲线（B样条）。
  2. 使用这些曲线作为边界或龙骨，通过放样或蒙皮（Lofting/Skinning）等方式构建一个复杂的曲面（如船体或飞机机翼）。
  3. 使用 `ShapeFix` 确保生成的几何体是水密的（watertight）。
  4. 对模型进行抽壳，并添加一些圆角，最终进行可视化。

---

## 第六阶段：OCAF - OCCT应用框架

**目标**: 学习OCCT最强大的部分——OCAF（OpenCASCADE Application Framework）。它是一个文档/属性模型，用于构建功能完整的、支持参数化、特征历史、撤销/重做（Undo/Redo）和数据持久化的CAD应用程序。

### 任务 6.1: `TDocStd` & `TDataStd` - 文档与标准属性

- **目标**: 理解OCAF的文档结构，学习如何创建文档、标签（Label）以及附加标准属性（如整数、实数、字符串）。
- **核心类**:
  - `TDocStd_Document`: OCAF应用程序的文档对象。
  - `TDF_Label`: 文档树中的节点，用于挂载属性。
  - `TDataStd_Name`, `TDataStd_Integer`, `TDataStd_Real`: 标准的数据属性类型。
- **示例焦点**: 创建一个OCAF文档，在根标签下创建两个子标签，分别命名为“Parameters”和“Shapes”。在“Parameters”下存储一个名为“Length”的 `TDataStd_Real` 属性。

### 任务 6.2: `TNaming` & `TFunction` - 参数化建模

- **目标**: 学习OCAF的核心：如何将形状与属性关联，以及如何通过函数定义它们之间的依赖关系，实现参数化驱动的模型更新。
- **核心类**:
  - `TNaming_NamedShape`: 将一个 `TopoDS_Shape` 存储在文档标签中的标准属性。
  - `TFunction_Function`: 定义一个“函数”，当其引用的输入属性变化时，该函数会自动重新执行以更新输出属性。
- **示例焦点**: 承接上一个任务，创建一个 `TFunction_Function`。该函数引用“Length”属性作为输入，其执行逻辑是创建一个长度为“Length”值的长方体，并将结果存放在“Shapes”标签下的一个 `TNaming_NamedShape` 属性中。演示修改“Length”值后，形状会自动更新。

### 阶段汇总示例 (任务 6.3)

- **目标**: 构建一个微型的参数化CAD应用原型。
- **示例焦点 (`examples/phase_6_parametric_model.py`)**:
  1. 创建一个OCAF文档。
  2. 在文档中定义多个参数属性（如 `width`, `height`, `depth`, `hole_radius`）。
  3. 创建一个函数，该函数依赖这些参数，执行“创建一个带中心孔的盒子”的逻辑，并将最终形状存入文档。
  4. 提供一个简单的命令行或GUI界面，允许用户修改参数值。
  5. 每次修改后，重新执行函数并更新AIS视图中的模型，从而展示参数化的效果。

---

## 第七阶段：自定义可视化与交互

**目标**: 超越 `SimpleGui`，学习更底层、更灵活的可视化与交互控制，将OCCT视图嵌入到自己的应用程序中，并实现自定义的交互逻辑。

### 任务 7.1: `SelectMgr` - 精细选择控制

- **目标**: 学习如何管理和响应精细的交互选择，如选择物体的面、边或顶点。
- **核心类**:
  - `SelectMgr_Selection`: 代表一个选择事件，可以从中获取被选中的对象和其子形状。
  - `AIS_InteractiveContext`: 学习其更高级的用法，如激活/停用选择模式（面、边、顶点）。
- **示例焦点**: 创建一个程序，允许用户在视图中只选择“面”。当用户点击一个面时，该面高亮，并在控制台打印出该面的类型或哈希码。

### 任务 7.2: `V3d_View` - 自定义视图控制

- **目标**: 学习直接控制OCCT的视图系统，实现自定义的相机控制和视图操作。
- **核心类**:
  - `V3d_View`: OCCT的核心视图类，控制相机位置、投影模式等。
  - `V3d_Viewer`: 管理多个视图的查看器。
  - `Graphic3d_Camera`: 相机对象，控制视点、目标点、上方向等。
- **示例焦点**: 创建一个程序，提供自定义的视图控制界面，允许用户通过按键或菜单精确控制相机位置、视图方向和投影模式（正交/透视）。

### 阶段汇总示例 (任务 7.3)

- **目标**: 构建一个完整的自定义可视化应用，集成精细选择和视图控制功能。
- **示例焦点 (`examples/phase_7_custom_visualization.py`)**:
  1. 创建一个复杂的3D场景，包含多个不同类型的几何体。
  2. 实现多种选择模式的切换（整体、面、边、顶点）。
  3. 为每种选择模式提供不同的高亮效果和信息显示。
  4. 实现自定义的相机控制系统，包括预设视图、动画过渡等。
  5. 添加测量工具，允许用户测量选中元素之间的距离。
  6. 提供导出功能，将当前视图保存为图像文件。

---

## 第八阶段：高级几何算法与分析

**目标**: 深入学习OCCT的高级几何算法，包括曲面分析、几何拟合、形状优化等专业CAD功能。

### 任务 8.1: `GeomLProp` & `BRepLProp` - 局部几何属性

- **目标**: 学习计算曲线和曲面上任意点的局部几何属性，如切线、法线、曲率等。
- **核心类**:
  - `GeomLProp_CLProps`: 计算曲线上的局部属性（切线、曲率等）。
  - `GeomLProp_SLProps`: 计算曲面上的局部属性（法线、主曲率等）。
  - `BRepLProp_CLProps`: 对B-Rep边的局部属性分析。
  - `BRepLProp_SLProps`: 对B-Rep面的局部属性分析。
- **示例焦点**: 创建一个复杂的自由曲面，然后在其上选择多个点，计算并可视化每个点的法线方向、主曲率方向和曲率值。

### 任务 8.2: `Approx` - 几何拟合与逼近

- **目标**: 学习使用OCCT的拟合算法，将点云数据拟合为B样条曲线或曲面。
- **核心类**:
  - `Approx_CurveOnSurface`: 在曲面上拟合曲线。
  - `Approx_SameParameter`: 参数化拟合。
  - `GeomAPI_PointsToBSpline`: 通过点集拟合B样条曲线。
  - `GeomAPI_PointsToBSplineSurface`: 通过点阵拟合B样条曲面。
- **示例焦点**: 读取一个包含噪声的点云数据文件，使用不同的拟合算法生成光滑的曲面，并比较拟合质量和计算性能。

### 阶段汇总示例 (任务 8.3)

- **目标**: 构建一个几何分析工具箱，集成多种高级几何算法。
- **示例焦点 (`examples/phase_8_geometric_analysis.py`)**:
  1. 实现一个交互式的几何分析界面。
  2. 支持导入各种格式的几何数据（STEP、IGES、点云等）。
  3. 提供曲率分析工具，以颜色映射显示曲面的曲率分布。
  4. 实现几何拟合功能，支持从点云重建光滑曲面。
  5. 添加几何质量检查工具，自动检测和报告几何缺陷。
  6. 提供详细的分析报告导出功能。
